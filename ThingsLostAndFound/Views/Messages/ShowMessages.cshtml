@model IEnumerable<object>
@{
    ViewBag.Title = "ShowMessages";
    Layout = "~/Views/Shared/_Layout.cshtml";
    List<ThingsLostAndFound.Models.Message> messagesList = Model.ToList()[0] as List<ThingsLostAndFound.Models.Message>;
}

<html>
    <body>
        <h2>Messages</h2>
        <p></p>
        <table class="table">
            <tr>
                <td>
                    @Html.Label("Message")
                </td>
                <td>
                    @Html.Label("Sended by")
                </td>
                <td>
                    @Html.Label("to")
                </td>
                <td>
                    @Html.Label("Subject")
                </td>
                <td>
                    @Html.Label("Object")
                </td>
                <td>
                    @Html.Label("Date Message")
                </td>
                <td>
                    @Html.Label("Response")
                </td>
            </tr>
            @foreach (var item in messagesList)
            {
                <tr>
                    <td>
                        @Html.DisplayFor(modelItem => item.Message1)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.InfoUser.UserName)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.InfoUser1.UserName)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.subject)
                    </td>
                    <td>
                        @{
                            // We can see in the subject column if the object is Found or Lost
                            if (item.FoundObjectId != null)
                            {
                                @Html.ActionLink(item.FoundObject.Title, "Details", "FoundObjects", new { id = item.FoundObjectId }, null)
                            }
                            if (item.LostObjectId != null)
                            {
                                @Html.ActionLink(item.LostObject.Title, "Details", "LostObjects", new { id = item.LostObjectId }, null)
                            }
                            if (item.subject == "Support")
                            {
                                @Html.Label("- -")
                            }
                        }
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.dateMessage)
                    </td>
                    <td>
                        @{
                            if (item.emailAddressUserDontRegis != null)
                            {
                                <a href="mailto: @item.emailAddressUserDontRegis">@item.emailAddressUserDontRegis</a>
                            }
                            else
                            {  
                                int idtemp = 0;
                                if (item.subject == "Found Object")
                                {
                                    idtemp = item.FoundObjectId.Value;
                                }
                                if (item.subject == "Lost Object")
                                {
                                    idtemp = item.LostObjectId.Value;
                                }
                                @Html.ActionLink(item.InfoUser.UserName, "SendMessage", "UsersContact", new { id = idtemp, userSendMsg = item.InfoUser1.Id, userDestMsg = item.InfoUser.Id, subject = item.subject }, null)
                            }
                        }
                        
                    </td>
                </tr>
                }
            </table>
</body>
</html>




